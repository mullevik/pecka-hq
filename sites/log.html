<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
</head>
<body style="margin: 1em;">

    <form id="form">
        <div class="mb-3">
            <label for="person" class="form-label">Kdo jsi?</label>
            <input type="text" class="form-control" id="person" aria-describedby="personHelp" required placeholder="například Štof">
            <div id="personHelp" class="form-text">Stačí napsat Peckovskou přezdívku, podle které tě případně dokáže někdo další kontaktovat a zeptat se na podrobnosti.</div>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="wood">
            <label class="form-check-label" for="wood">Za pecí je dostatek dřeva</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="well">
            <label class="form-check-label" for="well">Studna je v pořádku</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="fridge">
            <label class="form-check-label" for="fridge">V lednici nezůstaly žádné zbytky</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="ash">
            <label class="form-check-label" for="ash">V kamnech nezůstal popel</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="petroleum">
            <label class="form-check-label" for="petroleum">Dostatek petroleje v kanistrech</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="closed">
            <label class="form-check-label" for="closed">Všechno je správně zavřeno a zamčeno</label>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Nějaká další poznámka o tom, jak to na Pecce vypadá?</label>
            <textarea class="form-control" id="description" rows="4" aria-describedby="descriptionHelp" maxlength="500" placeholder="Třeba něco o tom že dochází sůl a je potřeba dokoupit novou..."></textarea>
            <div id="descriptionHelp" class="form-text">Například jaké prostředky docházejí a jsou třeba nakoupit, zda něco nefunguje, atd. (max 500 znaků)</div>
        </div>

        <button type="submit" id="submit" class="btn btn-primary">Odeslat</button>
    </form>

    <div id="status" style="display: none"></div>

    <div id="success" class="alert alert-success" role="alert" style="display: none;">Stav základny úspěšně zaznamenán. Obnov stránku aby ses přesvědčil.</div>
    <div id="danger" class="alert alert-danger" role="alert" style="display: none;">Něco se pokazilo - je to rozbitý. Zkus kontaktovat správce webu.</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>

        const API_URL = "https://script.google.com/macros/s/AKfycbycruz2Tbe7lg1-PD-qdzWxyL2Jhuag8P5yT21F5oPHQZDodc8ZpaxnG6dX2t9HtoSq5A/exec";

        
        function success() {
            document.getElementById("submit").innerHTML = "Odesláno";
            document.getElementById("submit").disabled = true;
            document.getElementById("status").innerText = `Stav základny úspěšně zaznamenán`;
            document.getElementById("status").className = "alert alert-success";
            document.getElementById("status").style.display = "block";
        }

        function failed() {
            document.getElementById("submit").innerHTML = "Zkusit znovu";
            document.getElementById("submit").disabled = false;
            document.getElementById("status").innerText = "Stav se nepodařilo odeslat";
            document.getElementById("status").className = "alert alert-danger";
            document.getElementById("status").style.display = "block";
        }

        function progress() {
            document.getElementById("submit").innerHTML = "<span class='spinner-border spinner-border-sm' role='status' aria-hidden='true'></span> Odesílání ..."
            document.getElementById("submit").disabled = true;
            document.getElementById("status").style.display = "none";
        }

        function submitLog() {

            progress();
            const data = {
                "person": document.getElementById("person").value,
                "wood": document.getElementById("wood").checked,
                "well": document.getElementById("well").checked,
                "ash": document.getElementById("ash").checked,
                "closed": document.getElementById("closed").checked,
                "fridge": document.getElementById("fridge").checked,
                "description": document.getElementById("description").value,
            };
            console.log(`Sending`);
            console.log(data);

            fetch(`${API_URL}?method=log`, {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                headers: {
                    'Content-Type': "text/plain;charset=utf-8",
                },
                redirect: "follow",
                body: JSON.stringify(data) // body data type must match "Content-Type" header
            }).then(function(response) {
                console.log(`Received`);
                console.log(response);
                return response.json();
            }).then(function(data) {
                console.log("Received body");
                console.log(data);
                if (data["status"] !== "ok") {
                    throw "Bad Response";
                }
                success();
            }).catch(function() {
                console.error("Failed to SEND log");
                failed();
            });
        }
    
        document.getElementById("form").addEventListener("submit", function(e){e.stopPropagation(); e.preventDefault(); submitLog(); return false;});

        console.log("Script for log submitting loaded successfully");

        // success();
        // failed();

    </script>
</body>
